apply plugin: 'groovy'
apply plugin: 'maven'
apply plugin: 'release'

buildscript {
   repositories {
      mavenCentral()
   }
   dependencies {
      classpath 'com.github.townsfolk:gradle-release:1.2'
   }
}

configurations {
    mavenDeploy
}

repositories {
    mavenCentral()
    maven {
        url 'https://oss.sonatype.org/content/repositories/snapshots/'
    }
    ivy {
        url 'http://releases.marmeladburk.fidesmo.com/'
        layout 'ivy'
    }
}

dependencies {
    compile gradleApi()
    compile localGroovy()
    compile 'com.fidesmo:gradle-javacard:0.2-SNAPSHOT'
    compile configuration: 'runtime', group: 'com.fidesmo', name: 'sec-client-core', version: '0.0.1'
    testCompile 'junit:junit:4.11'
    testCompile 'org.hamcrest:hamcrest-all:1.3'
    mavenDeploy 'org.kuali.maven.wagons:maven-s3-wagon:1.2.1'
}

group 'com.fidesmo'

uploadArchives {
    repositories {
        mavenDeployer {
            uniqueVersion = false
            configuration = configurations.mavenDeploy
            repository(url: "s3://${version.endsWith('-SNAPSHOT') ? 'snapshots' : 'releases'}.marmeladburk.fidesmo.com")
            pom {
                project {
                    name 'Gradle fidesmo plugin'
                    description 'Gradle plugin for easy development and deplyoment of java cardlets with the fidesmo service'
                    url 'https://github.com/fidesmo/gradle-plugin'
                    inceptionYear '2014'
                }
                artifactId = 'gradle-fidesmo'
            }
        }
    }
}
